{{/*
  params.html
  Takes inputs and page context.
  - Processes some inputs
  - Some inputs default to page/site params
  - Some inputs passed through
  - page context passed through
  Creates a new context for other partials to use

  @author @sean-au

  @context . Context from image partial

  @return Map including .img, .page and various inputs

  @access private

  @example - Go Template
  {{ partial "hri/private/params" . }}

  UPGRADE:

  santize siteParams > pageParams > pageMeta > inlineParams
  
*/}}

{{/*
{{ $s := newScratch }}
{{ $s.Set "params" dict }}
{{ $params :=  $s.Get "params" }}
*/}}

{{ $ctx := .ctx }}
{{ $meta := .meta }}
{{ $page :=  $ctx.Params.image }}

{{ $img := .img }}
{{ $type := .type }}
{{ $src := .src }}

{{ $params := dict }}
{{ $params = merge $params (dict 
  "img" $img
  "type" $type) }}


{{/* camelCase params have been kept to avoid breaking changes, will be deprecated in future versions */}}

{{ $partial_ctx := merge . (dict "meta" $meta "ctx" $ctx ) }}

{{ $general_params := partial "hri/private/params/image-general" $partial_ctx }}
{{ $params = merge $params $general_params }}

{{ if not $params.provider }}
  {{ $processing_params := partial "hri/private/params/image-processing" $partial_ctx }}
  {{ $params = merge $params (dict "options" $processing_params) }}
{{ end }}


{{ $placeholder_params := partial "hri/private/params/image-placeholder" $partial_ctx }}
{{ $params = merge $params $placeholder_params }}


{{ return $params }}

